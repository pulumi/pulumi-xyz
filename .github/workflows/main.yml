# WARNING: This file is autogenerated - changes will be overwritten when regenerated by https://github.com/pulumi/ci-mgmt

env:
  PULUMI_API: https://api.pulumi-staging.io
  PULUMI_GO_DEP_ROOT: ${{ github.workspace }}/..
  PULUMI_LOCAL_NUGET: ${{ github.workspace }}/nuget
  PULUMI_MISSING_DOCS_ERROR: "true"
  TF_APPEND_USER_AGENT: pulumi
  XYZ_REGION: us-west-2

jobs:
  tag_release_if_labeled_needs_release:
    name: Tag release if labeled as needs-release
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write # For ESC secrets.
    steps:
      - name: Checkout Repo
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
          persist-credentials: false
      - env:
          ESC_ACTION_ENVIRONMENT: github-secrets/${{ github.repository_owner }}-${{ github.event.repository.name }}
          ESC_ACTION_OIDC_AUTH: "true"
          ESC_ACTION_OIDC_ORGANIZATION: pulumi
          ESC_ACTION_OIDC_REQUESTED_TOKEN_TYPE: urn:pulumi:token-type:access_token:organization
        id: esc-secrets
        name: Fetch secrets from ESC
        uses: pulumi/esc-action@d68430affce2562c180bb4dbc1e1e3b4357d9d5f
      - name: check if this commit needs release
        if: ${{ env.RELEASE_BOT_ENDPOINT != '' }}
        uses: pulumi/action-release-by-pr-label@main
        with:
          command: "release-if-needed"
          repo: ${{ github.repository }}
          commit: 6be9338148a0394dcedef3fc2ca6216d9ca8fa59
          slack_channel: C02MGR8JVST
        env:
          RELEASE_BOT_ENDPOINT: ${{ steps.esc-secrets.outputs.RELEASE_BOT_ENDPOINT }}
          RELEASE_BOT_KEY: ${{ steps.esc-secrets.outputs.RELEASE_BOT_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

name: main
on:
  workflow_dispatch: {}
  pull_request: {}
